
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.7.0
  creationTimestamp: null
  name: mattermosts.installation.mattermost.com
spec:
  group: installation.mattermost.com
  names:
    kind: Mattermost
    listKind: MattermostList
    plural: mattermosts
    shortNames:
    - mm
    singular: mattermost
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: State of Mattermost
      jsonPath: .status.state
      name: State
      type: string
    - description: Image of Mattermost
      jsonPath: .status.image
      name: Image
      type: string
    - description: Version of Mattermost
      jsonPath: .status.version
      name: Version
      type: string
    - description: Endpoint
      jsonPath: .status.endpoint
      name: Endpoint
      type: string
    name: v1beta1
    schema:
      openAPIV3Schema:
        description: Mattermost is the Schema for the mattermosts API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: MattermostSpec defines the desired state of Mattermost
            properties:
              awsLoadBalancerController:
                properties:
                  annotations:
                    additionalProperties:
                      type: string
                    description: Annotations defines annotations passed to the Ingress
                      associated with Mattermost.
                    type: object
                  certificateARN:
                    description: Certificate arn for the ALB, required if SSL enabled
                    type: string
                  enabled:
                    description: An AWS ALB Ingress will be created instead of nginx
                    type: boolean
                  hosts:
                    description: Hosts allows specifying additional domain names for
                      Mattermost to use.
                    items:
                      description: IngressHost specifies additional hosts configuration.
                      properties:
                        hostName:
                          type: string
                      type: object
                    type: array
                  ingressClassName:
                    description: IngressClassName for your ingress
                    type: string
                  internetFacing:
                    description: Whether the Ingress will be internetfacing, default
                      is false
                    type: boolean
                type: object
              database:
                description: External Services
                properties:
                  disableReadinessCheck:
                    description: DisableReadinessCheck instructs Operator to not add
                      init container responsible for checking DB access. Can be used
                      to define custom init containers specified in `spec.PodExtensions.InitContainers`.
                    type: boolean
                  external:
                    description: Defines the configuration of and external database.
                    properties:
                      secret:
                        description: 'Secret contains data necessary to connect to
                          the external database. The Kubernetes Secret should contain:   -
                          Key: DB_CONNECTION_STRING | Value: Full database connection
                          string. It can also contain optional fields, such as:   -
                          Key: MM_SQLSETTINGS_DATASOURCEREPLICAS | Value: Connection
                          string to read replicas of the database.   - Key: DB_CONNECTION_CHECK_URL
                          | Value: The URL used for checking that the database is
                          accessible.     Omitting this value in the secret will cause
                          Operator to skip adding init container for database check.'
                        type: string
                    type: object
                  operatorManaged:
                    description: Defines the configuration of database managed by
                      Kubernetes operator.
                    properties:
                      backupRemoteDeletePolicy:
                        description: Defines the backup retention policy.
                        type: string
                      backupRestoreSecretName:
                        description: Defines the secret to be used when performing
                          a database restore.
                        type: string
                      backupSchedule:
                        description: Defines the interval for backups in cron expression
                          format.
                        type: string
                      backupSecretName:
                        description: Defines the secret to be used for uploading/restoring
                          backup.
                        type: string
                      backupURL:
                        description: Defines the object storage url for uploading
                          backups.
                        type: string
                      initBucketURL:
                        description: Defines the AWS S3 bucket where the Database
                          Backup is stored. The operator will download the file to
                          restore the data.
                        type: string
                      replicas:
                        description: Defines the number of database replicas. For
                          redundancy use at least 2 replicas. Setting this will override
                          the number of replicas set by 'Size'.
                        format: int32
                        type: integer
                      resources:
                        $ref: '#/definitions/k8s.io~1api~1core~1v1~0ResourceRequirements'
                        description: Defines the resource requests and limits for
                          the database pods.
                      storageSize:
                        description: Defines the storage size for the database. ie
                          50Gi
                        pattern: ^([+-]?[0-9.]+)([eEinumkKMGTP]*[-+]?[0-9]*)$
                        type: string
                      type:
                        description: Defines the type of database to use for an Operator-Managed
                          database.
                        type: string
                      version:
                        description: Defines the cluster version for the database
                          to use
                        type: string
                    type: object
                type: object
              deploymentTemplate:
                description: DeploymentTemplate defines configuration for the template
                  for Mattermost deployment.
                properties:
                  revisionHistoryLimit:
                    description: Defines the revision history limit for the mattermost
                      deployment.
                    format: int32
                    type: integer
                type: object
              dnsConfig:
                $ref: '#/definitions/k8s.io~1api~1core~1v1~0PodDNSConfig'
                description: Custom DNS configuration to use for the Mattermost Installation
                  pods.
              dnsPolicy:
                $ref: '#/definitions/k8s.io~1api~1core~1v1~0DNSPolicy'
                description: Custom DNS policy to use for the Mattermost Installation
                  pods.
              elasticSearch:
                description: ElasticSearch defines the ElasticSearch configuration
                  for Mattermost.
                properties:
                  host:
                    type: string
                  password:
                    type: string
                  username:
                    type: string
                type: object
              fileStore:
                description: FileStore defines the file store configuration for Mattermost.
                properties:
                  external:
                    description: Defines the configuration of an external file store.
                    properties:
                      bucket:
                        description: Set to the bucket name of your external MinIO
                          or S3.
                        type: string
                      secret:
                        description: 'Optionally enter the name of already existing
                          secret. Secret should have two values: "accesskey" and "secretkey".'
                        type: string
                      url:
                        description: Set to use an external MinIO deployment or S3.
                        type: string
                      useServiceAccount:
                        description: Optionally use service account with IAM role
                          to access AWS services, like S3.
                        type: boolean
                    type: object
                  externalVolume:
                    description: Defines the configuration of externally managed PVC
                      backed storage.
                    properties:
                      volumeClaimName:
                        description: The name of the matching volume claim for the
                          externally managed volume.
                        type: string
                    type: object
                  local:
                    description: Defines the configuration of PVC backed storage (local).
                      This is NOT recommended for production environments.
                    properties:
                      enabled:
                        description: Set to use local (PVC) storage, require explicit
                          enabled to prevent accidental misconfiguration.
                        type: boolean
                      storageSize:
                        description: Defines the storage size for the PVC. (default
                          50Gi)
                        pattern: ^([+-]?[0-9.]+)([eEinumkKMGTP]*[-+]?[0-9]*)$
                        type: string
                    required:
                    - enabled
                    type: object
                  operatorManaged:
                    description: Defines the configuration of file store managed by
                      Kubernetes operator.
                    properties:
                      replicas:
                        description: 'Defines the number of Minio replicas. Supply
                          1 to run Minio in standalone mode with no redundancy. Supply
                          4 or more to run Minio in distributed mode. Note that it
                          is not possible to upgrade Minio from standalone to distributed
                          mode. Setting this will override the number of replicas
                          set by ''Size''. More info: https://docs.min.io/docs/distributed-minio-quickstart-guide.html'
                        format: int32
                        type: integer
                      resources:
                        $ref: '#/definitions/k8s.io~1api~1core~1v1~0ResourceRequirements'
                        description: Defines the resource requests and limits for
                          the Minio pods.
                      storageSize:
                        description: Defines the storage size for Minio. ie 50Gi
                        pattern: ^([+-]?[0-9.]+)([eEinumkKMGTP]*[-+]?[0-9]*)$
                        type: string
                    type: object
                type: object
              image:
                description: Image defines the Mattermost Docker image.
                type: string
              imagePullPolicy:
                $ref: '#/definitions/k8s.io~1api~1core~1v1~0PullPolicy'
                description: Specify Mattermost deployment pull policy.
              imagePullSecrets:
                description: Specify Mattermost image pull secrets.
                items:
                  $ref: '#/definitions/k8s.io~1api~1core~1v1~0LocalObjectReference'
                type: array
              ingress:
                description: Ingress defines configuration for Ingress resource created
                  by the Operator.
                properties:
                  annotations:
                    additionalProperties:
                      type: string
                    description: Annotations defines annotations passed to the Ingress
                      associated with Mattermost.
                    type: object
                  enabled:
                    description: Enabled determines whether the Operator should create
                      Ingress resource or not. Disabling ingress on existing installation
                      will cause Operator to remove it.
                    type: boolean
                  host:
                    description: Host defines the Ingress host to be used when creating
                      the ingress rules.
                    type: string
                  hosts:
                    description: Hosts allows specifying additional domain names for
                      Mattermost to use.
                    items:
                      description: IngressHost specifies additional hosts configuration.
                      properties:
                        hostName:
                          type: string
                      type: object
                    type: array
                  ingressClass:
                    description: IngressClass will be set on Ingress resource to associate
                      it with specified IngressClass resource.
                    type: string
                  tlsSecret:
                    description: TLSSecret specifies secret used for configuring TLS
                      for Ingress. If empty TLS will not be configured.
                    type: string
                required:
                - enabled
                type: object
              ingressAnnotations:
                additionalProperties:
                  type: string
                description: 'IngressAnnotations defines annotations passed to the
                  Ingress associated with Mattermost. Deprecated: Use Spec.Ingress.Annotations.'
                type: object
              ingressName:
                description: 'IngressName defines the host to be used when creating
                  the ingress rules. Deprecated: Use Spec.Ingress.Host instead.'
                type: string
              licenseSecret:
                description: LicenseSecret is the name of the secret containing a
                  Mattermost license.
                type: string
              mattermostEnv:
                description: Optional environment variables to set in the Mattermost
                  application pods.
                items:
                  $ref: '#/definitions/k8s.io~1api~1core~1v1~0EnvVar'
                type: array
              podExtensions:
                description: PodExtensions specify custom extensions for Mattermost
                  pods. This can be used for custom readiness checks etc. These settings
                  generally don't need to be changed.
                properties:
                  containerPorts:
                    description: Additional Container Ports injected into pod's main
                      container. The setting does not override ContainerPorts defined
                      by the Operator.
                    items:
                      $ref: '#/definitions/k8s.io~1api~1core~1v1~0ContainerPort'
                    type: array
                  initContainers:
                    description: Additional InitContainers injected into pods. The
                      setting does not override InitContainers defined by the Operator.
                    items:
                      $ref: '#/definitions/k8s.io~1api~1core~1v1~0Container'
                    type: array
                  sidecarContainers:
                    description: 'Additional sidecar containers injected into pods.
                      The setting does not override any sidecar containers defined
                      by the Operator. Note that sidecars are injected as standard
                      pod containers alongside the Mattermost application server.
                      In the future, this may be migrated to use the currently-feature-gated
                      init container method introduced in k8s v1.28: https://kubernetes.io/blog/2023/08/25/native-sidecar-containers/'
                    items:
                      $ref: '#/definitions/k8s.io~1api~1core~1v1~0Container'
                    type: array
                type: object
              podTemplate:
                description: PodTemplate defines configuration for the template for
                  Mattermost pods.
                properties:
                  containerSecurityContext:
                    $ref: '#/definitions/k8s.io~1api~1core~1v1~0SecurityContext'
                    description: Defines the security context for the Mattermost app
                      server container.
                  extraAnnotations:
                    additionalProperties:
                      type: string
                    description: Defines annotations to add to the Mattermost app
                      server pods. Overrides of default prometheus annotations are
                      ignored.
                    type: object
                  extraLabels:
                    additionalProperties:
                      type: string
                    description: Defines labels to add to the Mattermost app server
                      pods. Overrides what is set in ResourceLabels, does not override
                      default labels (app and cluster labels).
                    type: object
                  securityContext:
                    $ref: '#/definitions/k8s.io~1api~1core~1v1~0PodSecurityContext'
                    description: Defines the security context for the Mattermost app
                      server pods.
                type: object
              probes:
                description: Probes defines configuration of liveness and readiness
                  probe for Mattermost pods. These settings generally don't need to
                  be changed.
                properties:
                  livenessProbe:
                    $ref: '#/definitions/k8s.io~1api~1core~1v1~0Probe'
                    description: Defines the probe to check if the application is
                      up and running.
                  readinessProbe:
                    $ref: '#/definitions/k8s.io~1api~1core~1v1~0Probe'
                    description: Defines the probe to check if the application is
                      ready to accept traffic.
                type: object
              replicas:
                description: Replicas defines the number of replicas to use for the
                  Mattermost app servers.
                format: int32
                type: integer
              resourceLabels:
                additionalProperties:
                  type: string
                type: object
              resourcePatch:
                description: "ResourcePatch specifies JSON patches that can be applied
                  to resources created by Mattermost Operator. \n WARNING: ResourcePatch
                  is highly experimental and subject to change. Some patches may be
                  impossible to perform or may impact the stability of Mattermost
                  server. \n Use at your own risk when no other options are available."
                properties:
                  deployment:
                    properties:
                      disable:
                        type: boolean
                      patch:
                        type: string
                    type: object
                  service:
                    properties:
                      disable:
                        type: boolean
                      patch:
                        type: string
                    type: object
                type: object
              scheduling:
                description: Scheduling defines the configuration related to scheduling
                  of the Mattermost pods as well as resource constraints. These settings
                  generally don't need to be changed.
                properties:
                  affinity:
                    $ref: '#/definitions/k8s.io~1api~1core~1v1~0Affinity'
                    description: If specified, affinity will define the pod's scheduling
                      constraints
                  nodeSelector:
                    additionalProperties:
                      type: string
                    description: 'NodeSelector is a selector which must be true for
                      the pod to fit on a node. Selector which must match a node''s
                      labels for the pod to be scheduled on that node. More info:
                      https://kubernetes.io/docs/concepts/configuration/assign-pod-node/'
                    type: object
                  resources:
                    $ref: '#/definitions/k8s.io~1api~1core~1v1~0ResourceRequirements'
                    description: Defines the resource requests and limits for the
                      Mattermost app server pods.
                  tolerations:
                    description: 'Defines tolerations for the Mattermost app server
                      pods More info: https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/'
                    items:
                      $ref: '#/definitions/k8s.io~1api~1core~1v1~0Toleration'
                    type: array
                type: object
              serviceAnnotations:
                additionalProperties:
                  type: string
                type: object
              size:
                description: 'Size defines the size of the Mattermost. This is typically
                  specified in number of users. This will override replica and resource
                  requests/limits appropriately for the provided number of users.
                  This is a write-only field - its value is erased after setting appropriate
                  values of resources. Accepted values are: 100users, 1000users, 5000users,
                  10000users, and 250000users. If replicas and resource requests/limits
                  are not specified, and Size is not provided the configuration for
                  5000users will be applied. Setting ''Replicas'', ''Scheduling.Resources'',
                  ''FileStore.Replicas'', ''FileStore.Resource'', ''Database.Replicas'',
                  or ''Database.Resources'' will override the values set by Size.
                  Setting new Size will override previous values regardless if set
                  by Size or manually.'
                type: string
              updateJob:
                description: UpdateJob defines configuration for the template for
                  the update job.
                properties:
                  disabled:
                    description: Determines whether to disable the Operator's creation
                      of the update job.
                    type: boolean
                  extraAnnotations:
                    additionalProperties:
                      type: string
                    description: Defines annotations to add to the update job pod.
                    type: object
                  extraLabels:
                    additionalProperties:
                      type: string
                    description: Defines labels to add to the update job pod. Overrides
                      what is set in ResourceLabels, does not override default label
                      (app label).
                    type: object
                type: object
              useIngressTLS:
                description: 'UseIngressTLS specifies whether TLS secret should be
                  configured for Ingress. Deprecated: Use Spec.Ingress.TLSSecret.'
                type: boolean
              useServiceLoadBalancer:
                type: boolean
              version:
                description: Version defines the Mattermost Docker image version.
                type: string
              volumeMounts:
                description: Defines additional volumeMounts to add to Mattermost
                  application pods.
                items:
                  $ref: '#/definitions/k8s.io~1api~1core~1v1~0VolumeMount'
                type: array
              volumes:
                description: Volumes allows for mounting volumes from various sources
                  into the Mattermost application pods.
                items:
                  $ref: '#/definitions/k8s.io~1api~1core~1v1~0Volume'
                type: array
            type: object
          status:
            description: MattermostStatus defines the observed state of Mattermost
            properties:
              endpoint:
                description: The endpoint to access the Mattermost instance
                type: string
              error:
                description: The last observed error in the deployment of this Mattermost
                  instance
                type: string
              image:
                description: The image running on the pods in the Mattermost instance
                type: string
              observedGeneration:
                description: The last observed Generation of the Mattermost resource
                  that was acted on.
                format: int64
                type: integer
              replicas:
                description: Total number of non-terminated pods targeted by this
                  Mattermost deployment
                format: int32
                type: integer
              resourcePatch:
                description: Status of specified resource patches.
                properties:
                  deploymentPatch:
                    description: PatchStatus represents status of particular patch.
                    properties:
                      applied:
                        type: boolean
                      error:
                        type: string
                    type: object
                  servicePatch:
                    description: PatchStatus represents status of particular patch.
                    properties:
                      applied:
                        type: boolean
                      error:
                        type: string
                    type: object
                type: object
              state:
                description: Represents the running state of the Mattermost instance
                type: string
              updatedReplicas:
                description: Total number of non-terminated pods targeted by this
                  Mattermost deployment that are running with the desired image.
                format: int32
                type: integer
              version:
                description: The version currently running in the Mattermost instance
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
